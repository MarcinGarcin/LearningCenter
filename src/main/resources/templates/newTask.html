<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Task</title>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/task.js" defer></script>
</head>
<body>
<section>
  <form id="taskForm" action="/req/newTask" method="post">
    <h1>Create Task</h1>
    <div class="inputbox">
      <ion-icon name="person-outline"></ion-icon>
      <input type="text" id="name" name="name" required>
      <label for="name">Task Name</label>
    </div>
    <div class="inputbox">
      <ion-icon name="list-outline"></ion-icon>
      <select id="priority" name="priority" required>
        <option value="LOW">Low</option>
        <option value="MEDIUM">Medium</option>
        <option value="HIGH">High</option>
      </select>
      <label for="priority">Priority</label>
    </div>
    <button id="submit" type="submit">Create Task</button>
    <div class="back">
      <p><a href="/req/tasks">Back to Tasks</a></p>
    </div>
  </form>
</section>

<script>
  document.getElementById("taskForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent the default form submission

    const name = document.getElementById("name").value;
    const priority = document.getElementById("priority").value;

    const taskData = {
      name,
      priority
    };

    const jsonData = JSON.stringify(taskData);
    fetch('/req/newTask', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: jsonData
    })
            .then(response => {
              if (response.ok) {
                alert('Task created successfully! Redirecting to tasks...');
                window.location.href = '/task'; // Redirect after successful task creation
              } else {
                alert('Failed to create task. Please try again.');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('An error occurred. Please try again.');
            });
  });
</script>
</body>
</html>
